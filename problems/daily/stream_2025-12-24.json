[
  {
    "problem_id": "stream_sql_001",
    "difficulty": "easy",
    "topic": "dau",
    "requester": "그로스 마케팅 팀",
    "question": "2025년 12월 첫째 주(12월 1일 ~ 12월 7일)의 일별 순 방문자 수(DAU)를 확인하고 싶습니다. 연말 프로모션 성과 측정용 리포트에 사용할 예정이니 데이터 추출 부탁드립니다.",
    "context": "연말을 맞이하여 12월 초부터 대규모 프로모션을 시작했습니다. 프로모션이 사용자들의 활동에 어떤 영향을 미치는지 일별로 파악하여, 실시간으로 마케팅 전략을 조정하고자 합니다.",
    "submission_requirements": "컬럼은 `date`, `dau`로 지정하고, `date`를 기준으로 오름차순 정렬하여 제출해주세요.",
    "answer_sql": "SELECT\n  DATE(event_time) AS date,\n  COUNT(DISTINCT user_id) AS dau\nFROM\n  stream_events\nWHERE\n  event_time >= '2025-12-01' AND event_time < '2025-12-08'\nGROUP BY\n  date\nORDER BY\n  date ASC;",
    "expected_columns": [
      "date",
      "dau"
    ],
    "sort_keys": [
      "date"
    ],
    "hint": "COUNT(DISTINCT user_id)를 사용하여 고유한 사용자 수를 계산할 수 있습니다. TIMESTAMP 타입의 event_time 컬럼을 DATE() 함수를 이용해 날짜별로 그룹화하세요.",
    "expected_meta": {
      "grading_table": "expected_stream_sql_001"
    }
  },
  {
    "problem_id": "stream_sql_002",
    "difficulty": "easy",
    "topic": "channel",
    "requester": "퍼포먼스 마케팅 팀",
    "question": "어떤 채널을 통해 가장 많은 세션이 발생하고 있는지 궁금합니다. 유입 채널별 총 세션 수를 확인해주세요.",
    "context": "다음 분기 광고 예산 분배를 위해 채널별 트래픽 기여도를 파악해야 합니다. 세션 수가 가장 기본적인 성과 지표가 될 것이므로, 전체 기간 데이터를 기준으로 가장 효율적인 채널을 파악하고자 합니다.",
    "submission_requirements": "컬럼은 `channel`, `session_count`로 지정하고, `session_count`를 기준으로 내림차순 정렬해주세요.",
    "answer_sql": "SELECT\n  channel,\n  COUNT(DISTINCT session_id) AS session_count\nFROM\n  stream_events\nGROUP BY\n  channel\nORDER BY\n  session_count DESC;",
    "expected_columns": [
      "channel",
      "session_count"
    ],
    "sort_keys": [
      "session_count DESC"
    ],
    "hint": "session_id는 고유한 세션을 식별하는 키입니다. 채널별로 고유한 세션 수를 세기 위해 COUNT(DISTINCT session_id)를 사용하세요.",
    "expected_meta": {
      "grading_table": "expected_stream_sql_002"
    }
  },
  {
    "problem_id": "stream_sql_003",
    "difficulty": "medium",
    "topic": "funnel",
    "requester": "프로덕트 팀",
    "question": "2025년 11월 한 달간 핵심 퍼널(방문 → 상품 조회 → 구매)의 단계별 전환을 분석하고 싶습니다. 각 단계에 도달한 고유 사용자 수를 알려주세요.",
    "context": "사용자들이 어떤 단계에서 가장 많이 이탈하는지 파악하여 해당 단계의 UI/UX를 개선하고자 합니다. 데이터를 통해 개선 우선순위를 정하고, 제품 개선의 효과를 측정하는 기준점으로 삼을 계획입니다.",
    "submission_requirements": "단일 행으로 `visitors`, `product_viewers`, `purchasers` 컬럼을 출력해주세요. 2025년 11월 1일부터 11월 30일까지의 데이터만 사용해주세요.",
    "answer_sql": "SELECT\n  COUNT(DISTINCT CASE WHEN event_name = 'visit' THEN user_id END) AS visitors,\n  COUNT(DISTINCT CASE WHEN event_name = 'view_product' THEN user_id END) AS product_viewers,\n  COUNT(DISTINCT CASE WHEN event_name = 'purchase' THEN user_id END) AS purchasers\nFROM\n  stream_events\nWHERE\n  event_time >= '2025-11-01' AND event_time < '2025-12-01';",
    "expected_columns": [
      "visitors",
      "product_viewers",
      "purchasers"
    ],
    "sort_keys": [],
    "hint": "CASE 문과 COUNT(DISTINCT ...)를 함께 사용하면 한 번의 쿼리로 여러 이벤트에 대한 고유 사용자 수를 집계할 수 있습니다. 각 컬럼에 대해 특정 event_name일 때만 user_id를 카운트하도록 조건부 집계를 사용하세요.",
    "expected_meta": {
      "grading_table": "expected_stream_sql_003"
    }
  },
  {
    "problem_id": "stream_sql_004",
    "difficulty": "medium",
    "topic": "revenue",
    "requester": "사업 기획팀",
    "question": "2025년 하반기(7월~12월) 월별 총 매출과 월간 활성 사용자 수(MAU)를 함께 보고 싶습니다. 두 지표의 추세를 비교 분석할 예정입니다.",
    "context": "매출과 사용자 수의 상관관계를 파악하여 비즈니스 성장 전략을 수립하는 데 활용할 것입니다. 특정 월에 매출이 급증하거나 감소했을 때, 사용자 수 변화가 원인이었는지 확인이 필요합니다.",
    "submission_requirements": "컬럼은 `month`, `total_revenue`, `mau`로 지정하고, `month`를 기준으로 오름차순 정렬해주세요. `month`는 'YYYY-MM' 형식의 텍스트로 출력해야 합니다.",
    "answer_sql": "WITH monthly_mau AS (\n  SELECT\n    TO_CHAR(event_time, 'YYYY-MM') AS month,\n    COUNT(DISTINCT user_id) AS mau\n  FROM\n    stream_events\n  WHERE\n    event_time >= '2025-07-01'\n  GROUP BY 1\n),\nmonthly_revenue AS (\n  SELECT\n    TO_CHAR(date, 'YYYY-MM') AS month,\n    SUM(revenue) AS total_revenue\n  FROM\n    stream_daily_metrics\n  WHERE\n    date >= '2025-07-01'\n  GROUP BY 1\n)\nSELECT\n  m.month,\n  r.total_revenue,\n  m.mau\nFROM\n  monthly_mau m\nJOIN\n  monthly_revenue r ON m.month = r.month\nORDER BY\n  m.month ASC;",
    "expected_columns": [
      "month",
      "total_revenue",
      "mau"
    ],
    "sort_keys": [
      "month"
    ],
    "hint": "WITH 절(CTE)을 사용해 월별 MAU와 월별 매출을 각각의 테이블에서 계산한 후, 월('YYYY-MM')을 기준으로 두 결과를 JOIN 하세요. TO_CHAR 함수를 사용하면 날짜 형식을 쉽게 맞출 수 있습니다.",
    "expected_meta": {
      "grading_table": "expected_stream_sql_004"
    }
  },
  {
    "problem_id": "stream_sql_005",
    "difficulty": "hard",
    "topic": "device",
    "requester": "UX/UI 디자인 팀",
    "question": "디바이스(PC, Mobile)별로 구매 전환율에 차이가 있는지 확인하고 싶습니다. 2025년 10월 데이터 기준으로 디바이스별 방문자 수, 구매자 수, 그리고 구매 전환율(%)을 계산해주세요.",
    "context": "모바일과 PC 환경에서 사용자 경험에 차이가 있을 것으로 예상됩니다. 전환율이 낮은 디바이스를 파악하고, 해당 디바이스의 사용자 경험을 집중적으로 개선하여 전체 매출을 증대시키는 것이 목표입니다. (구매 전환율 = 구매자 수 / 방문자 수 * 100)",
    "submission_requirements": "컬럼은 `device`, `visitors`, `purchasers`, `conversion_rate`로 지정해주세요. 전환율(conversion_rate)은 소수점 둘째 자리까지 반올림해주세요. `device`를 기준으로 오름차순 정렬하여 제출해주세요.",
    "answer_sql": "WITH device_summary AS (\n  SELECT\n    device,\n    COUNT(DISTINCT CASE WHEN event_name = 'visit' THEN user_id END) AS visitors,\n    COUNT(DISTINCT CASE WHEN event_name = 'purchase' THEN user_id END) AS purchasers\n  FROM\n    stream_events\n  WHERE\n    event_time >= '2025-10-01' AND event_time < '2025-11-01'\n    AND device IN ('PC', 'Mobile')\n  GROUP BY\n    device\n)\nSELECT\n  device,\n  visitors,\n  purchasers,\n  ROUND((purchasers::FLOAT / visitors * 100), 2) AS conversion_rate\nFROM\n  device_summary\nORDER BY\n  device ASC;",
    "expected_columns": [
      "device",
      "visitors",
      "purchasers",
      "conversion_rate"
    ],
    "sort_keys": [
      "device"
    ],
    "hint": "CTE를 사용하여 디바이스별 방문자(visit 이벤트) 수와 구매자(purchase 이벤트) 수를 먼저 집계합니다. 전환율을 계산할 때 정수 나눗셈 오류를 피하기 위해 숫자 중 하나를 FLOAT 타입으로 형변환(CAST)해야 합니다. (예: `purchasers::FLOAT`)"
  },
  {
    "problem_id": "stream_sql_006",
    "difficulty": "hard",
    "topic": "funnel",
    "requester": "데이터 분석 팀",
    "question": "2025년 11월에 처음으로 우리 서비스에 방문한 신규 사용자 코호트가 첫 구매까지 평균적으로 며칠이 걸리는지 분석해주세요.",
    "context": "신규 사용자의 온보딩 경험과 초기 구매 유도 전략의 효과를 측정하고 싶습니다. 첫 방문부터 첫 구매까지 걸리는 시간(Time to First Purchase)은 사용자 활성화의 핵심 지표입니다. 이 지표를 통해 마케팅 캠페인의 질을 평가하고 제품 개선 방향을 설정하고자 합니다.",
    "submission_requirements": "컬럼은 `avg_days_to_first_purchase` 하나만 출력해주세요. 결과는 소수점 둘째 자리까지 반올림해주세요.",
    "answer_sql": "WITH user_first_events AS (\n  SELECT\n    user_id,\n    MIN(CASE WHEN event_name = 'visit' THEN event_time END) AS first_visit_time,\n    MIN(CASE WHEN event_name = 'purchase' THEN event_time END) AS first_purchase_time\n  FROM\n    stream_events\n  GROUP BY\n    user_id\n),\nnov_cohort_purchases AS (\n  SELECT\n    user_id,\n    first_purchase_time - first_visit_time AS time_to_purchase\n  FROM\n    user_first_events\n  WHERE\n    first_visit_time >= '2025-11-01'\n    AND first_visit_time < '2025-12-01'\n    AND first_purchase_time IS NOT NULL\n)\nSELECT\n  ROUND(AVG(EXTRACT(EPOCH FROM time_to_purchase) / 86400), 2) AS avg_days_to_first_purchase\nFROM\n  nov_cohort_purchases;",
    "expected_columns": [
      "avg_days_to_first_purchase"
    ],
    "sort_keys": [],
    "hint": "첫 번째 CTE에서 사용자별 첫 방문 시간과 첫 구매 시간을 구합니다. 두 번째 CTE에서 11월에 첫 방문한 사용자를 필터링하고, 구매 이력이 있는 사용자의 방문-구매 시간 차이를 계산합니다. 마지막으로 `EXTRACT(EPOCH FROM ...)`를 사용하여 시간 차이를 초 단위로 변환하고, 86400(24*60*60)으로 나누어 일(day) 단위로 변환한 후 평균을 계산하세요.",
    "expected_meta": {
      "grading_table": "expected_stream_sql_006"
    }
  }
]